{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{{ category.name }} - {% trans "Store" %} - AL BURAQ GROUP{% endblock %}

{% block content %}
<!-- Breadcrumb & Header -->
<section style="padding: 130px 0 40px; background: var(--bg-darker);">
    <div class="container">
        <nav style="margin-bottom: 1rem;">
            <a href="{% url 'store:category_list' %}" style="color: var(--text-secondary);">{% trans "Store" %}</a>
            <span style="color: var(--text-muted); margin: 0 0.5rem;">/</span>
            <span style="color: var(--gold-light);">{{ category.name }}</span>
        </nav>
        <h1 data-aos="fade-up">{{ category.name }}</h1>
        {% if category.description %}
        <p style="color: var(--text-secondary); margin-top: 0.5rem;" data-aos="fade-up" data-aos-delay="100">
            {{ category.description }}</p>
        {% endif %}
    </div>
</section>

<!-- Products Grid -->
<section class="section">
    <div class="container">
        {% if subcategories %}
        <div class="mb-2xl">
            <h3 class="mb-lg">{% trans "Subcategories" %}</h3>
            <div class="flex gap-md" style="flex-wrap: wrap;">
                {% for sub in subcategories %}
                <a href="{% url 'store:category_detail' sub.slug %}" class="btn btn-ghost">{{ sub.name }}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="grid grid-cols-4 gap-lg">
            {% for product in products %}
            <div class="card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0 }}25">
                {% if product.get_main_image %}
                <img src="{{ product.get_main_image.url }}" alt="{{ product.name }}" class="card-image">
                {% else %}
                <div class="card-image"
                    style="background: var(--bg-card-hover); display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-image" style="font-size: 3rem; color: var(--text-muted);"></i>
                </div>
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1rem;">{{ product.name|truncatewords:8 }}</h5>
                    <div class="flex justify-between items-center mt-md">
                        <div>
                            <span style="color: var(--gold-light); font-size: 1.25rem; font-weight: 700;">
                                Â¥{{ product.price_rmb }}</span>
                            <span style="color: var(--text-muted); font-size: 0.8rem;">/{{ product.get_unit_display }}</span>
                        </div>
                        <span class="badge">{% trans "Min" %}: {{ product.min_order_quantity }}</span>
                    </div>
                    <div class="flex gap-sm mt-md">
                        <a href="{% url 'store:product_detail' product.slug %}" class="btn btn-ghost btn-sm"
                            style="flex: 1;">
                            <i class="fas fa-eye"></i>
                        </a>
                        <button onclick="addToCart({{ product.pk }})" class="btn btn-primary btn-sm" style="flex: 1;">
                            <i class="fas fa-cart-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center" style="grid-column: 1 / -1; padding: 4rem;">
                <i class="fas fa-box-open" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                <h3 style="color: var(--text-muted);">{% trans "No products in this category yet" %}</h3>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.has_other_pages %}
        <div class="flex justify-center gap-sm mt-2xl">
            {% if products.has_previous %}
            <a href="?page={{ products.previous_page_number }}" class="btn btn-ghost">
                <i class="fas fa-chevron-left"></i>
            </a>
            {% endif %}

            {% for num in products.paginator.page_range %}
            {% if num == products.number %}
            <span class="btn btn-primary">{{ num }}</span>
            {% elif num > products.number|add:'-3' and num < products.number|add:'3' %} <a href="?page={{ num }}"
                class="btn btn-ghost">{{ num }}</a>
                {% endif %}
                {% endfor %}

                {% if products.has_next %}
                <a href="?page={{ products.next_page_number }}" class="btn btn-ghost">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}