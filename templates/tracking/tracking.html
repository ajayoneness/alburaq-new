{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Track Your Shipment" %} - AL BURAQ GROUP{% endblock %}

{% block content %}
<!-- Tracking Hero -->
<section
    style="padding: 150px 0 100px; background: linear-gradient(180deg, var(--bg-darker) 0%, var(--bg-dark) 100%); position: relative; overflow: hidden;">
    <div class="container text-center">
        <h1 class="mb-lg" data-aos="fade-up">{% trans "Track Your" %} <span class="text-gold">{% trans "Shipment" %}</span></h1>

        <!-- Tracking Form -->
        <div class="card card-glass" style="max-width: 600px; margin: 0 auto; padding: 2rem;" data-aos="fade-up"
            data-aos-delay="100">
            <form method="POST" class="tracking-form">
                {% csrf_token %}
                <div class="form-group mb-md relative">
                    <i class="fas fa-search absolute-icon"></i>
                    <input type="text" name="tracking_number" class="form-control pl-xl"
                        placeholder="{% trans 'Enter tracking number...' %}" value="{{ tracking_number|default:'' }}" required
                        style="padding-left: 3rem; font-size: 1.1rem; height: 55px;">
                </div>
                <button type="submit" class="btn btn-primary btn-block btn-lg">
                    {% trans "Track Now" %} <i class="fas fa-arrow-right ml-sm"></i>
                </button>
            </form>
        </div>
    </div>
    <i class="fas fa-map-marked-alt"
        style="position: absolute; right: -50px; bottom: -50px; font-size: 300px; opacity: 0.03; color: var(--gold-primary);"></i>
</section>

<!-- Tracking Results -->
{% if tracking_number %}
<section class="section">
    <div class="container" style="max-width: 900px;">
        {% if shipment %}
        <!-- Shipment Info Card -->
        <div class="card card-glass mb-xl" data-aos="fade-up">
            <div class="flex justify-between items-center mb-lg pb-md border-b border-white-10 flex-wrap gap-md">
                <div>

                <!-- Info Grid -->
                <div style="background: rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: stretch; flex-wrap: wrap;">
                    {% if shipment.estimated_delivery %}
                    <div style="padding: 1.5rem; text-align: center; flex: 1; min-width: 200px; border-left: 1px solid rgba(255,255,255,0.05);">
                        <i class="fas fa-calendar-alt mb-xs" style="color: var(--gold-light); font-size: 1.2rem;"></i>
                        <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.2rem;">تاريخ الوصول المتوقع</p>
                        <p style="font-weight: 600; color: #fff;">{{ shipment.estimated_delivery }}</p>
                    </div>
                    {% endif %}
                    <div style="padding: 1.5rem; text-align: center; flex: 1; min-width: 200px; border-left: 1px solid rgba(255,255,255,0.05);">
                        <i class="fas fa-box mb-xs" style="color: var(--gold-light); font-size: 1.2rem;"></i>
                         <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.2rem;">الطرود</p>
                        <p style="font-weight: 600; color: #fff;">{{ shipment.total_packages }}</p>
                    </div>
                    {% if shipment.total_weight %}
                    <div style="padding: 1.5rem; text-align: center; flex: 1; min-width: 200px;">
                        <i class="fas fa-weight-hanging mb-xs" style="color: var(--gold-light); font-size: 1.2rem;"></i>
                        <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.2rem;">الوزن</p>
                        <p style="font-weight: 600; color: #fff;">{{ shipment.total_weight }} كجم</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Timeline -->
                <div style="padding: 2rem;">
                    <h4 class="mb-lg" style="color: var(--gold-primary);">سجل التتبع</h4>
                    <div class="tracking-timeline">
                        {% for update in shipment.updates.all %}
                        <div class="timeline-item" style="display: flex; gap: 1.5rem; position: relative; padding-bottom: 2rem; opacity: 0; animation: fadeSlideIn 0.5s ease forwards; animation-delay: {{ forloop.counter0|add:2 }}00ms;">
                            <!-- Line -->
                            {% if not forloop.last %}
                            <div style="position: absolute; right: 19px; top: 40px; bottom: 0; width: 2px; background: rgba(255,255,255,0.1);"></div>
                            {% endif %}
                            
                            <!-- Icon -->
                            <div style="width: 40px; height: 40px; background: {% if forloop.first %}var(--gold-gradient){% else %}rgba(255,255,255,0.1){% endif %}; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                <i class="fas fa-check" style="font-size: 0.9rem; color: {% if forloop.first %}#000{% else %}var(--text-muted){% endif %};"></i>
                            </div>
                            
                            <!-- Content -->
                            <div style="padding-top: 0.2rem; margin-right: 1.5rem;">
                                <p style="font-weight: 600; font-size: 1.1rem; margin-bottom: 0.3rem; color: {% if forloop.first %}#fff{% else %}var(--text-secondary){% endif %};">{{ update.get_status_display }}</p>
                                <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 0.3rem; line-height: 1.5;">{{ update.description }}</p>
                                <p style="color: var(--text-muted); font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="far fa-clock"></i> {{ update.timestamp|date:"Y-m-d H:i" }}
                                    {% if update.location %}
                                    <span>•</span> <i class="fas fa-map-pin"></i> {{ update.location }}
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        {% empty %}
                        <p style="color: var(--text-muted); text-align: center; padding: 2rem;">لا توجد تحديثات متاحة حالياً.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <script>
                // Animate progress bar on load
                setTimeout(() => {
                    const progressBar = document.querySelector('.progress-bar-fill');
                    if (progressBar) {
                        progressBar.style.width = '{{ shipment.get_status_percentage }}%';
                    }
                }, 300);
            </script>
            
            <style>
                @keyframes fadeSlideIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            </style>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- Help Section -->
<section class="section" style="background: var(--bg-darker);">
    <div class="container">
        <div class="grid grid-cols-3 gap-xl">
            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up">
                <i class="fas fa-question-circle"
                    style="font-size: 3rem; color: var(--gold-light); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">نسيت رقم التتبع؟</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">تواصل مع فريق الدعم وسنساعدك في العثور على شحنتك.</p>
            </div>

            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up" data-aos-delay="100">
                <i class="fas fa-clock" style="font-size: 3rem; color: var(--teal); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">تأخرت الشحنة؟</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">تواصل معنا للحصول على تحديثات حول أي شحنات متأخرة.</p>
            </div>

            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up" data-aos-delay="200">
                <i class="fas fa-headset" style="font-size: 3rem; color: var(--purple); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">تحتاج مساعدة؟</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">فريقنا متاح 24/7 لمساعدتك.</p>
                <a href="https://wa.me/{{ COMPANY_WHATSAPP|slice:'1:' }}" class="btn btn-primary btn-sm">
                    <i class="fab fa-whatsapp"></i> تواصل معنا
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}